<html>
<head>
    <title>Speech quality demonstrator</title>
    <script src="http://code.jquery.com/jquery-2.0.3.js"></script>

    <script type="text/javascript">
    </script>

    <script type="text/javascript">

	/* Cycle:
	0. Stimuli ended
	1. Loading
	2. Playing
	3. (Stalling)
	4. Finished OR Error
	*/

        /*
        Play the current selected sample.
        Element must contain "alt" and nextElementSibling is used as description.
        */
        var lastElement = null;
        function playStimuli(element) {
	        console.log("playStimuli(): " + element.alt);
            var audioElement = document.getElementById('audio'); //$('#audio')[0]
            var audioFile = element.alt;

            onStimuliEnded();
            if (!audio.paused) {
                audio.pause();
		        if (lastElement === element) {
		            $('#descriptionPane')[0].innerHTML = "";
		            return;
		        }
            }

            lastElement = element;
            lastElement.parentNode.className = "active";
            lastElement.src = "images/speaker_playing.gif";

            //Set content to description pane
            $('#descriptionPane')[0].innerHTML = element.nextElementSibling.innerHTML;

            audio.src = audioFile;
            audio.play();
           $('#progressBarWaiting')[0].hidden = "hidden";
           $('#progressBarPlaying')[0].hidden = "";
        }

	function onStimuliPlaying() {
	    console.log("Playing");
	}

	function onStimuliTimeUpdate(audio) {
        console.log("Time update " + audio.currentTime + " / " + audio.duration);
        if (!isNaN(audio.duration))
            $('#progressBarPlaying')[0].value = (audio.currentTime / audio.duration);
	}
	
	function onStimuliProgress(e) { //How much loaded?
        console.log("Progress");
	}

	function onStimuliStalling() {
	    console.log("Stalling");
	}

	//Stimuli playback callbacks.
    function onStimuliEnded() {
        console.log("Stimuli playback finished");
        if (lastElement != null) {
            lastElement.parentNode.className = "";
            lastElement.src = "images/speaker.png";
            $('#progressBarWaiting')[0].hidden = "";
            $('#progressBarPlaying')[0].hidden = "hidden";
            $('#progressBarPlaying')[0].value = 0;
        }
    }


	function onStimuliError(reason) {
	    console.log("Stimuli playback error: " + reason);
	    onStimuliEnded();
	}
    </script>
    <script type="text/javascript">
	//Function block of helper methods.

	function relayClickToChilds(element) {    
	    for (var i in element.childNodes)        
		if (typeof element.childNodes[i].click === 'function')
		    element.childNodes[i].click();
	}
    </script>

    <style>
        img {
            height: 3em;
            width: 3em;
        }

        .mainPane {
            height: 90%;
            width: 100%;
            background-color: #ffd800;
        }

            .mainPane .left {
                float: left;
                width: 80%;
                height: 100%;
                background-color: gray;
            }

            .mainPane .right {
                float: right;
                width: 20%;
                height: 100%;
                background-color: lightgrey;
            }

            .mainPane .left .table {
                width: 100%;
                background-color: aqua;
                float: left;
            }

        table, th, td {
            border: 1px solid black;
        }

        .selected {
            background-color: blue;
        }
        
        .playing {
            background-color: red;
        }
        
        .progressBar {
            width : 100%;
        }
    </style>
</head>
<body>
    <h1>Speech Quality Demonstrator</h1>
    <audio id="audio" onplaying="onStimuliPlaying(this)" ontimeupdate="onStimuliTimeUpdate(this)" onstalling="onStimuliStalling(this)" onended="onStimuliEnded(this)" onerror="onStimuliError(this)"></audio>
    <div class="mainPane">
        <div class="left">
            <table class="table">
                <tr>
                    <th>Stimuli</th>
                    <th>Codec 1</th>
                    <th>Codec 2</th>
                    <th>Codec 3</th>
                    <th>Codec 4</th>
                </tr>
                <tr>
                    <td>Speech</td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" ondblClick="" alt="audio/audio1.wav" />
                        <div hidden="hidden">
		                    Description speech 1
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                            Description speech 2
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                            Description speech 3
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Music</td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio1.wav" />
                        <div hidden="hidden">
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                        </div>
                    </td>
                    <td>
                        <img src="images/speaker.png" onclick="playStimuli(this)" alt="audio/audio2.wav" />
                        <div hidden="hidden">
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="right">
            <div id="descriptionPane"></div>
        </div>
        <div>
            <progress id="progressBarWaiting" class="progressBar"></progress>
            <progress id="progressBarPlaying" class="progressBar" hidden="hidden"></progress>
        </div>
    </div>
</body>
</html>
