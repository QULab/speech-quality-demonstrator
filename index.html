<!DOCTYPE html>
<html>
    <head lang="de">
        <script src="jquery-2.0.3.js"></script>
        <script type="text/javascript">
            /* Cycle:
             0. Stimuli ended
             1. Loading
             2. Playing
             3. (Stalling)
             4. Finished OR Error
             */

            /*
             Play the current selected sample.
             Element must contain "alt", which is the source.
             */
            function playStimuli(element) {
                console.log("playStimuli(): " + element);
                var audioPlayer = element.nextElementSibling;                
                var previousElement = $("#playing")[0];
                
                onStimuliEnded();
                if (element == previousElement) return;

                audioPlayer.addEventListener("playing", function() {onStimuliPlaying();});
                audioPlayer.addEventListener("stalling", function() {onStimuliStalling();});
                audioPlayer.addEventListener("timeupdate", function() {onStimuliTimeUpdate();});
                audioPlayer.addEventListener("ended", function() {onStimuliEnded();});
                audioPlayer.addEventListener("error", function() {onStimuliError()});

                element.id = "playing";
                element.src = "graphics/speaker_playing.svg";

                audioPlayer.play();
                $('#progressBarWaiting')[0].hidden = "hidden";
                $('#progressBarPlaying')[0].hidden = "";
                $('#progressBarPlaying')[0].value  = 0.01;
            }

            function onStimuliPlaying() {
                console.log("Playing");
            }

            function onStimuliTimeUpdate() {
                var element = $("#playing")[0];
                if (element === undefined) return;
                
                var audio = element.nextElementSibling;
                
                console.log("Time update " + audio.currentTime + " / " + audio.duration);
                if (!isNaN(audio.duration)) 
                    $('#progressBarPlaying')[0].value = (audio.currentTime / audio.duration);
            }

            function onStimuliProgress(e) { //How much loaded?
                console.log("Progress");
            }

            function onStimuliStalling() {
                console.log("Stalling");
            }

            //Stimuli playback callbacks.
            function onStimuliEnded() {
                console.log("Stimuli playback finished");
                var element = $("#playing")[0];
                if (element === undefined) return;
   
                element.removeAttribute("id");
                element.src                    = "graphics/speaker.svg";
                $('#progressBarWaiting')[0].hidden = "";
                $('#progressBarPlaying')[0].hidden = "hidden";
                $('#progressBarPlaying')[0].value  = 0.01;
                var audio = element.nextElementSibling;
                audio.pause();
                audio.currentTime = 0;
            }

            function onStimuliError(reason) {
                console.log("Stimuli playback error: " + reason);
                onStimuliEnded();
            }
        </script>
        <script type="text/javascript">
            //Function block of helper methods.

            function relayClickToChilds(element) {
                for (var i in element.childNodes) 
                    if (typeof element.childNodes[i].click === 'function') 
                        element.childNodes[i].click();
                    }
        </script>
        <script type="text/javascript">
                function switchLanguageDE() {
                        switchLanguage("de");
                }
                function switchLanguageEN() {
                        switchLanguage("en");
                }
                
                var languageList = ["de", "en"];
                function switchLanguage(lang) {
                        if ($.inArray(lang, languageList) == -1) {
                                console.log("Switching language to " + lang + " doesn't work. Language code unknown.");
                                return;
                        }
                        console.log("Switching language to " + lang);

                        var queryUnhide = '[lang="' + lang + '"]';

                        languageList.map(function(lang) {
                                console.log($('[lang="' + lang + '"'));
                                $('[lang="' + lang + '"').attr("hidden", "hidden");
                                });

                        $(queryUnhide).removeAttr("hidden");
                }
        </script>
        <style>
            body {
                font-family: "courier";
                            word-break: break-all;
            }
            .fullscreen {
                height: 100%;
                margin: 0px;
                min-height: 100%;
                width: 100%;
            }
            #header {
                float: left;
                width: 100%;
            }
            #headerBox {
                background: #cde1ff;
                border-radius: 0.5em;
                margin: 0px auto 0px auto;
                text-align: center;
                width: 50%;
            }
            #content {
                height: 100%;
            }
            #stimuliTable {
                border-collapse: collapse;
                border-spacing: 0px;

                width:100%;
            }
            img {
                height: 2em;
                width: 2em;
            }
            td, th {
                text-align: center;
            }
            tr td {
                border-top-color: #999;
                border-top-style: solid;
                border-top-width: 1px;
                width:1000px;
            }
            td:first-child {
                font-weight: bold;
            }
            col:nth-child(even) {
                background: #cde1ff;
            }
            
            audio {
                display: none;
            }

            /* Dynamic styles */
            .playing {}
            
        </style>
        <style>
        /*Omage to K.I.T.T.*/
            .kittLED {
                position:relative;
                width:5em;
                height:0.7em;

                -webkit-animation:KITT 3s infinite; /*Safari and Chrome*/
            }

                .kitt-left {
                    width:50%;
                    height:100%;
                    float:right;
                    background-image: -webkit-linear-gradient(right, #FFFFFF 0%, #FF0000 50%);
                }

                .kitt-right {
                    width:50%;
                    height:100%;
                    float:right;
                    background-image: -webkit-linear-gradient(left, #FFFFFF 0%, #FF0000 50%);
                }

                @-webkit-keyframes KITT /*Safari and Chrome*/ {
                    0%  {left:10%;}
                    50% {left:90%;}
                    100% {left:10%;};
                }
        </style>
        <title>
                Speech quality demonstrator
        </title>
    </head>
    <body>
        <div class="fullscreen">
            <div id="header">
                <div id="headerBox">
                    Qualit&auml;t von Telefonaten: Wie
                    <i>klingen</i>
                    St&ouml;rungen bei Telefonaten?
                </div>
                <div style="height:.5em;"></div>
            </div>
            <div id="content">
                <table id="stimuliTable">
                    <col><col><col><col><col><col><col><col><col><col><col><col><col><col><col>
                    <tr>
                        <th></th>
                        <th>Original</th>
                        <th>LPC</th>
                        <th>GSM</th>
                        <th>G.722</th>
                        <th>MP3: 192kbit/s</th>
                        <th>Rauschen</th>
                        <th>Echo</th>
                        <th>Packetverlust: 10</th>
                        <th>Packetverlust: 50</th>
                        <th>Packetverlust: 10 (mit Entst&ouml;rung)</th>
                        <th>Packetverlust: 50 (mit Entst&ouml;rung)</th>

                    </tr>
                    <tr>
                        <td>
            				<div>Sprache</div>
            			</td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.lpc.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.gsm-full-rate.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.g722plc0.raw.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech-enc192k.mp3" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.whitenoise.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.echo.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.plr10.g722plc0.raw.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.plr50.g722plc0.raw.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.plr10.g722plc3.raw.wav" />
                        </td>
                        <td>
                            <img onclick="playStimuli(this)" src="graphics/speaker.svg" />
                            <audio src="audio/de-speech.plr50.g722plc3.raw.wav" />
                        </td>
                    </tr>
                </table>
        </div>
    </div>
        <div style="position:absolute;bottom:5px;text-align:center;width:95%;margin: 0 auto 0 auto;">
            <div style="text-align:center;width:20em;margin: 0 auto 0 auto;">
                <div id="progressBarWaiting" class="kittLED">
                    <div class="kitt-left"></div>
                    <div class="kitt-right"></div>
                </div>
            </div>              
            <progress id="progressBarPlaying" style="width:25em;" hidden="hidden"></progress>
        </div>
<!--    <div>
        <div onclick="switchLanguageEN()"">Englisch</div>
        <div onclick="switchLanguageDE()">Deutsch</div>
    </div> -->
</body>
</html>
